/*
JavaScript Snake
Original author: Patrick Gillespie  + contributors - http://patorjk.com/games/snake
Modifications by Łukasz Wójcik - https://www.lukem.net
*/
var SNAKE=SNAKE||{};SNAKE.addEventListener=function(e,t,n,a){e.addEventListener(t,n,a)},SNAKE.removeEventListener=function(e,t,n,a){e.removeEventListener(t,n,a)},SNAKE.Snake=SNAKE.Snake||function(){var e=[],t=function(){this.elm=null,this.elmStyle=null,this.row=-1,this.col=-1,this.xPos=-1e3,this.yPos=-1e3,this.next=null,this.prev=null};return function(n){if(n&&n.playingBoard){var a=this,o=n.playingBoard,l=(0,1),d=-1,i=!0,s=!0,r=-1,c=[0,1,0,-1],u=[-1,0,1,0],h=[],k=[],p=null,y=null,g=80,m=!1,f=document.getElementById("selectMode");f&&f.addEventListener("change",function(e){var t=(e=e||{}).target?parseInt(e.target.value):75;isNaN(t)?t=75:t<50&&(t=75),g=t,setTimeout(function(){document.getElementById("game-area").focus()},10)}),a.snakeBody={},a.snakeBody.b0=new t,a.snakeBody.b0.row=n.startRow||1,a.snakeBody.b0.col=n.startCol||1,a.snakeBody.b0.xPos=a.snakeBody.b0.row*o.getBlockWidth(),a.snakeBody.b0.yPos=a.snakeBody.b0.col*o.getBlockHeight(),a.snakeBody.b0.elm=v(),a.snakeBody.b0.elmStyle=a.snakeBody.b0.elm.style,o.getBoardContainer().appendChild(a.snakeBody.b0.elm),a.snakeBody.b0.elm.style.left=a.snakeBody.b0.xPos+"px",a.snakeBody.b0.elm.style.top=a.snakeBody.b0.yPos+"px",a.snakeBody.b0.next=a.snakeBody.b0,a.snakeBody.b0.prev=a.snakeBody.b0,a.snakeLength=1,a.snakeHead=a.snakeBody.b0,a.snakeTail=a.snakeBody.b0,a.snakeHead.elm.className=a.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),a.snakeHead.elm.className+=" snake-snakebody-alive",a.handleArrowKeys=function(e){if(m)return;let t=-1;switch(e){case 37:case 65:t=3;break;case 38:case 87:t=0;break;case 39:case 68:t=1;break;case 40:case 83:t=2}r!==l&&(d=t),(2!==Math.abs(t-l)&&i||s)&&(r=t,i=!1,s=!1)},a.handleTouchstart=function(e){const t=e.touches[0];p=t.clientX,y=t.clientY},a.handleTouchmove=function(e){if(m)return;if(!p||!y)return;!function(e,t){const n=p-e,o=y-t;Math.abs(n)>Math.abs(o)?n>0?a.handleArrowKeys(37):a.handleArrowKeys(39):o>0?a.handleArrowKeys(38):a.handleArrowKeys(40),p=null,y=null}(e.touches[0].clientX,e.touches[0].clientY)},a.go=function(){var e=a.snakeHead,t=a.snakeTail,n=o.grid;if(a.snakeTail=t.prev,a.snakeHead=t,n[t.row]&&n[t.row][t.col]&&(n[t.row][t.col]=0),-1!==r&&(l=r,-1!==d&&(r=d,d=-1)),i=!0,t.col=e.col+c[l],t.row=e.row+u[l],t.xPos=e.xPos+h[l],t.yPos=e.yPos+k[l],t.elmStyle||(t.elmStyle=t.elm.style),t.elmStyle.left=t.xPos+"px",t.elmStyle.top=t.yPos+"px",0===n[t.row][t.col])n[t.row][t.col]=1,setTimeout(function(){a.go()},g);else if(n[t.row][t.col]>0)a.handleDeath();else if(n[t.row][t.col]===o.getGridFoodValue()){if(n[t.row][t.col]=1,!a.eatFood())return void a.handleWin();setTimeout(function(){a.go()},g)}},a.eatFood=function(){e.length<=1&&B(2);for(var t,n=e.splice(0,1),l=n.length,d=a.snakeTail;l--;)t="b"+a.snakeLength++,a.snakeBody[t]=n[l],a.snakeBody[t].prev=d,a.snakeBody[t].elm.className=a.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),a.snakeBody[t].elm.className+=" snake-snakebody-alive",d.next=a.snakeBody[t],d=a.snakeBody[t];return a.snakeTail=a.snakeBody[t],a.snakeTail.next=a.snakeHead,a.snakeHead.prev=a.snakeTail,!!o.foodEaten()},a.handleDeath=function(){w(o.handleDeath)},a.handleWin=function(){w(o.handleWin)},a.rebirth=function(){m=!1,i=!0,s=!0,d=-1},a.reset=function(){if(!1!==m){for(var t,l=[],d=a.snakeHead.next;d!==a.snakeHead;)t=d.next,d.prev=null,d.next=null,l.push(d),d=t;a.snakeHead.next=a.snakeHead,a.snakeHead.prev=a.snakeHead,a.snakeTail=a.snakeHead,a.snakeLength=0;for(var i=0;i<l.length;i++)l[i].elm.style.left="-1000px",l[i].elm.style.top="-1000px",l[i].elm.className=a.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),l[i].elm.className+=" snake-snakebody-alive";e.concat(l),a.snakeHead.elm.className=a.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),a.snakeHead.elm.className+=" snake-snakebody-alive",a.snakeHead.row=n.startRow||1,a.snakeHead.col=n.startCol||1,a.snakeHead.xPos=a.snakeHead.row*o.getBlockWidth(),a.snakeHead.yPos=a.snakeHead.col*o.getBlockHeight(),a.snakeHead.elm.style.left=a.snakeHead.xPos+"px",a.snakeHead.elm.style.top=a.snakeHead.yPos+"px"}},B(2),h[0]=0,h[1]=o.getBlockWidth(),h[2]=0,h[3]=-1*o.getBlockWidth(),k[0]=-1*o.getBlockHeight(),k[1]=0,k[2]=o.getBlockHeight(),k[3]=0}function v(){var e=document.createElement("div");return e.className="snake-snakebody-block",e.style.left="-1000px",e.style.top="-1000px",e.style.width=o.getBlockWidth()+"px",e.style.height=o.getBlockHeight()+"px",e}function B(n){for(var a,l=v(),d=1;d<n;d++)(a=new t).elm=l.cloneNode(!0),a.elmStyle=a.elm.style,o.getBoardContainer().appendChild(a.elm),e[e.length]=a;(a=new t).elm=l,o.getBoardContainer().appendChild(a.elm),e[e.length]=a}function w(e){a.snakeHead.elm.style.zIndex=function(e){var t,n=0,a=0;for(t in e)e[t].elm.currentStyle?a=parseFloat(e[t].elm.style["z-index"],10):window.getComputedStyle&&(a=parseFloat(document.defaultView.getComputedStyle(e[t].elm,null).getPropertyValue("z-index"),10)),!isNaN(a)&&a>n&&(n=a);return n+1}(a.snakeBody),a.snakeHead.elm.className=a.snakeHead.elm.className.replace(/\bsnake-snakebody-alive\b/,""),a.snakeHead.elm.className+=" snake-snakebody-dead",m=!0,e()}}}(),SNAKE.Food=SNAKE.Food||function(){var e=0;function t(e,t){return Math.floor(Math.random()*(t+1-e))+e}return function(n){if(n&&n.playingBoard){var a,o,l=n.playingBoard,d=e++,i=document.createElement("div");i.setAttribute("id","snake-food-"+d),i.className="snake-food-block",i.style.width=l.getBlockWidth()+"px",i.style.height=l.getBlockHeight()+"px",i.style.left="-1000px",i.style.top="-1000px",l.getBoardContainer().appendChild(i),this.getFoodElement=function(){return i},this.randomlyPlaceFood=function(){l.grid[a]&&l.grid[a][o]===l.getGridFoodValue()&&(l.grid[a][o]=0);for(var e=0,n=0,d=0,s=l.grid.length-1,r=l.grid[0].length-1;0!==l.grid[e][n];)if(e=t(1,s),n=t(1,r),++d>2e4)return!1;return l.grid[e][n]=l.getGridFoodValue(),a=e,o=n,i.style.top=e*l.getBlockHeight()+"px",i.style.left=n*l.getBlockWidth()+"px",!0}}}}(),SNAKE.Board=SNAKE.Board||function(){var e=0;function t(e){var t,n=0,a=0;for(t in e)e[t].elm.currentStyle?a=parseFloat(e[t].elm.style["z-index"],10):window.getComputedStyle&&(a=parseFloat(document.defaultView.getComputedStyle(e[t].elm,null).getPropertyValue("z-index"),10)),!isNaN(a)&&a>n&&(n=a);return n+1}return function(n){var a,o,l,d,i,s,r,c,u,h,k,p=this,y=e++,g=n||{},m=250,f=250,v=1;function B(){(r=document.createElement("div")).setAttribute("id","playingField"),r.className="snake-playing-field",SNAKE.addEventListener(r,"click",function(){s.focus()},!1),(c=document.createElement("div")).className="snake-panel-component",c.innerHTML="Score: 0",u=function(){var e=document.createElement("div");e.id="sbWelcome"+y,e.className="snake-dialog snake-welcome-dialog";var t=document.createElement("p");t.innerHTML="Use arrow keys or swipes to play the game.";var n=document.createElement("button");n.appendChild(document.createTextNode("Play"));var a=function(){SNAKE.removeEventListener(window,"keyup",o,!1),e.style.display="none",p.setBoardState(1),p.getBoardContainer().focus()},o=function(e){if(!e)var e=window.event;var t=e.which?e.which:e.keyCode;32!==t&&13!==t||a()};return SNAKE.addEventListener(window,"keyup",o,!1),SNAKE.addEventListener(n,"click",a,!1),e.appendChild(t),e.appendChild(n),e}(),h=w("You died!","sbTryAgain","snake-dialog snake-try-again-dialog"),k=w("You won!","sbWin","snake-dialog snake-win-dialog"),SNAKE.addEventListener(s,"keyup",function(e){if(!e)e=window.event;return e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},!1),s.className="snake-game-container",s.appendChild(r),s.appendChild(c),s.appendChild(u),s.appendChild(h),s.appendChild(k),o=new SNAKE.Snake({playingBoard:p,startRow:2,startCol:2}),a=new SNAKE.Food({playingBoard:p}),u.style.zIndex=1e3}function w(e,t,n){var a=document.createElement("div");a.id=t+y,a.className=n;var o=document.createElement("p");o.innerHTML=e;var l=document.createElement("button");l.appendChild(document.createTextNode("Play again"));var d=function(){a.style.display="none",p.resetBoard(),p.setBoardState(1),p.getBoardContainer().focus()};return SNAKE.addEventListener(window,"keyup",function(e){if(0===v&&"block"===a.style.display){e||(e=window.event);var t=e.which?e.which:e.keyCode;32!==t&&13!==t||d()}},!0),SNAKE.addEventListener(l,"click",d,!1),a.appendChild(o),a.appendChild(l),a}function b(e){var n=Math.max(t(o.snakeBody),t({tmp:{elm:a.getFoodElement()}}));s.removeChild(e),s.appendChild(e),e.style.zIndex=n,e.style.display="block",p.setBoardState(0)}function E(){SNAKE.addEventListener(s,"keydown",l,!1)}function S(){SNAKE.addEventListener(s,"touchstart",d,{passive:!0}),SNAKE.addEventListener(s,"touchmove",i,{passive:!0})}function N(){SNAKE.removeEventListener(s,"keydown",l,!1)}function H(){SNAKE.removeEventListener(s,"touchstart",d,{passive:!0}),SNAKE.removeEventListener(s,"touchmove",i,{passive:!0})}p.grid=[],p.resetBoard=function(){N(),H(),o.reset(),c.innerHTML="Score: 0",p.setupPlayingField()},p.getBoardState=function(){return v},p.setBoardState=function(e){v=e},p.getGridFoodValue=function(){return-1},p.getPlayingFieldElement=function(){return r},p.setBoardContainer=function(e){"string"==typeof e&&(e=document.getElementById(e)),e!==s&&(s=e,r=null,p.setupPlayingField())},p.getBoardContainer=function(){return s},p.getBlockWidth=function(){return 20},p.getBlockHeight=function(){return 20},p.setupPlayingField=function(){var e,t,n,u;r||B(),!0===g.fullScreen?(n=0,u=0,e=window.innerWidth,t=window.innerHeight):(n=g.top,u=g.left,e=g.width,t=g.height);var h=2*p.getBlockWidth()+e%p.getBlockWidth(),k=Math.min(m*p.getBlockWidth()-h,e-h),y=3*p.getBlockHeight()+t%p.getBlockHeight(),v=Math.min(f*p.getBlockHeight()-y,t-y);s.style.left=u+"px",s.style.top=n+"px",s.style.width=e+"px",s.style.height=t+"px",r.style.left=p.getBlockWidth()+"px",r.style.top=p.getBlockHeight()+"px",r.style.width=k+"px",r.style.height=v+"px";var w=y-p.getBlockHeight(),b=p.getBlockHeight()+v+Math.round((w-30)/2)+"px";c.style.top=b,p.grid=[];for(var x=k/p.getBlockWidth()+2,C=v/p.getBlockHeight()+2,A=0;A<C;A++){p.grid[A]=[];for(var P=0;P<x;P++)p.grid[A][P]=0===P||0===A||P===x-1||A===C-1?1:0}a.randomlyPlaceFood(),l=function(e){if(!e)e=window.event;var t=e.which?e.which:e.keyCode;if(1===p.getBoardState()){if(!(t>=37&&t<=40)&&87!==t&&65!==t&&83!==t&&68!==t)return;N(),l=function(e){if(!e)e=window.event;var t=e.which?e.which:e.keyCode;return o.handleArrowKeys(t),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},E(),o.rebirth(),o.handleArrowKeys(t),p.setBoardState(2),o.go()}return e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},i=function(e){return 1===p.getBoardState()&&(H(),i=function(e){if(!e)e=window.event;o.handleTouchmove(e)},d=function(e){if(!e)e=window.event;o.handleTouchstart(e)},S(),o.rebirth(),o.handleTouchmove(e),p.setBoardState(2),o.go()),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),!1},E(),S()},p.foodEaten=function(){return c.innerHTML="Score: "+o.snakeLength,!!a.randomlyPlaceFood()},p.handleDeath=function(){b(h)},p.handleWin=function(){b(k)},g.fullScreen=void 0!==g.fullScreen&&g.fullScreen,g.top=void 0===g.top?0:g.top,g.left=void 0===g.left?0:g.left,g.width=void 0===g.width?400:g.width,g.height=void 0===g.height?400:g.height,g.fullScreen&&SNAKE.addEventListener(window,"resize",function(){p.setupPlayingField()},!1),p.setBoardState(0),g.boardContainer&&p.setBoardContainer(g.boardContainer)}}();